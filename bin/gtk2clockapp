#!/usr/bin/env ruby
require 'gtk2clockapp'
require 'help_parser'
OPTIONS = HelpParser[Gtk2ClockApp::VERSION, <<HELP]
Usage:
  gtk2clockapp [:options+]
Options:
  -h --help
  -v --version
  --fullscreen
  --notdecorated
  --size=INT
Types:
  INT /^[1-9]\\d{1,2}$/
HELP
HelpParser.int?(:size)
gui = Gtk2ClockApp.gui
gui.set_weather '' # 'â›… 75F 92F/66F'
gui.set_spot    '' # 'ðŸ—  WUT: $500'
gui.set_alert   '' # 'ðŸ“¢ Attention!'
Thread.new do
  while line = $stdin.gets
    line.chomp!
    case line
    when /^Weather: (.*)$/
      gui.set_weather $1
    when /^Spot: (.*)$/
      gui.set_spot $1
    when /^Mode: (.*)$/
      mode = $1
      case mode
      when 'night'
        gui.night_mode
      when 'day'
        gui.day_mode
      else
        $stderr.puts 'Unrecognized mode: '+mode
      end
    else
      gui.set_alert line
    end
  end
end
Gtk.main
